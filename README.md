# Useful Habit Tracker DRF

Создание SPA веб-приложение с DRF для полезных привычек и устранения вредных. Интеграция с Tg ботом.

## Описание

В 2018 году Джеймс Клир написал книгу «Атомные привычки», которая посвящена приобретению новых полезных привычек и
искоренению старых плохих привычек.
В рамках проекта была реализована бэкенд-часть SPA веб-приложения трекера полезных привычек.

## Выполненная работа
* Использованы Переменные окружения.
* Все необходимые модели описаны или переопределены.<br>
`Habit`<br>
`User`<br>
* Все необходимые эндпоинты реализованы:<br>
`Регистрация`<br>
`Авторизация`<br>
`Список привычек текущего пользователя с пагинацией`<br>
`Список публичных привычек`<br>
`Создание привычки`<br>
`Редактирование привычки`<br>
`Удаление привычки`<br>
* Настроены все необходимые валидаторы:<br>
`Исключить одновременный выбор связанной привычки и указания вознаграждения.`<br>
`Время выполнения должно быть не больше 120 секунд.`<br>
`В связанные привычки могут попадать только привычки с признаком приятной привычки.`<br>
`У приятной привычки не может быть вознаграждения или связанной привычки.`<br>
`Нельзя выполнять привычку реже, чем 1 раз в 7 дней.`<br>
* Описанные права доступа заложены:<br>
`Каждый пользователь имеет доступ только к своим привычкам по механизму CRUD.`<br>
`Пользователь может видеть список публичных привычек без возможности их как-то редактировать или удалять.`<br>
* Интеграция с Telegram настроена.
* Настроена CORS.
* Реализована пагинацию(*5 привычек на страницу*).
* Настроена отложенная задача через Celery.
* Проект покрыли тестами на 90%.
* Имеется список зависимостей.
* Результат проверки Flake8 равен 100%, при исключении миграций.
## Работа с Docker: команды
```docker-compose up -d --build```
## Установка

1. Скачайте проект в домашнюю директорию.
2. Активируйте виртуальное окружение командой: poetry shell.
3. Установите зависимости командой: poetry install.

## Перед первым запуском программы:

1. Создайте Базу данных (в данной работе используется PostgreSQL) и перейдите в файл .env.sample и пропишите переменные
   окружения в формате(все данные после "=" в виде примера):

```ini
SECRET_KEY = 'django-secret-key'
DEBUG = True/False

DATABASE_NAME = 'name_of_db'
DATABASE_USER = 'db_user'
DATABASE_PASSWORD = 'your_password'
DATABASE_HOST = '127.0.0.1'
DATABASE_PORT = 5432

CELERY_BROKER_URL = 'smth://123.1.1.0:1234/0'
CELERY_RESULT_BACKEND = 'smth://123.1.1.0:1234/0'
CELERY_TIMEZONE = 'UTC'

TG_URL = 'https://api.telegram.org/bot'
TG_TOKEN = '123456:ABC-DEF1234ghIkl-zyx57W2v1u123ew11'
```

2. Выполните команды:
   - Для миграции в базу данных: `python manage.py migrate`
   - Для включения Redis(в терминале): `sudo service redis-server start`
   - Команда для запуска сервера: `python manage.py runserver`

***
## Работа кода

**Создание пользователя**
- Перед тем, как создать пользователя, создайте/войдите в аккаунт Telegram и перейдите по ссылке 
[Tg-бота](https://t.me/getmyid_bot). При выполнении команды `/start` вы получите User ID и Chat ID.
- Создание пользователя проходит через `post`-запрос в сервисе для обслуживания API(Например, [Postman](https://www.postman.com/)).
При создании пользователя в поле `chat_id` прописывается ID, полученный от [Tg-бота](https://t.me/getmyid_bot).
- После регистрации идет получение токена: через указания данных(Поля `username` и `password`) производится `post`-запрос.
При получении ответа, нужно скопировать значение ключа `access` и при дальнейшем пользовании в поле авторизации прописывать
`Bearer {token}` 


**Создание Tg-бота**
- Для создания Telegram-бота найдите в чате бота [BotFather](https://t.me/BotFather).
 Начните с ним диалог и выберите команду создания нового бота `/start`:


   - BotFather предложит ввести имя вашего бота:
   
   
   Здесь нужно указать видимое имя бота, т.е. то, которое отображается пользователям. Например, `ExampleBot`.
   
   - После этого BotFather спросит юзернейм вашего бота. Здесь бота нужно назвать уникально — это тот уникальный идентификатор, 
   - по которому бота можно будет найти. Также важно, чтобы имя заканчивалось на `_bot`. Например, `example_bot`.
   - Если имя подходит под все правила, BotFather предоставит токен и полезные ссылки для использования бота
   - Токен будет использован ботом для обращения к API Telegram-сервисов, поэтому его необходимо сразу сохранить в переменные окружения и не распространять.

***
**Возможные команды для управления привычками**

Все команды прописаны в документации по ссылке ` http://127.0.0.1:8000/api/schema/`

**Запуск отложенных задач**
  Для запуска отложенный задач(*отправка сообщения с привычкой*), нужно прописать команды:
* `celery -A config worker -l INFO` (для пользователей Windows OS нужно дописать `-P eventlet`)
* `celery -A config beat -l INFO`


## Для завершения работы

В терминале, где запущен сервер, worker и beat, прожать **Ctrl + C**








